<h1 id="the-basics-of-cmake">The basics of CMake</h1>
<p>Building software is a fairly tedious process, and you should take
care that it is done correctly and reproducible. This is especially
important for large code bases, but even for small projects, it saves a
lot of time and headache when you do it right.</p>
<p><a href="https://cmake.org/">CMake</a> is a build tool that is
cross-platform and versatile. Here, you will get some basic information
on CMake and how to use it to build Fortran programs, but there is much
more to learn.</p>
<h2 id="single-source-file">Single source file</h2>
<p>CMake uses recipes to build software, i.e,.
<code>CMakeLists.txt</code> files. Suppose you want to build the “hello
Fortran” example code. In the same directory as the source file
<code>hello_fortran.f90</code>, create a file
<code>CMakeLists.txt</code> with the following contents.</p>
<pre><code>cmake_minimum_required(VERSION 3.0)

project(fortran_basics LANGUAGES Fortran)

set(CMAKE_Fortran_MODULE_DIRECTORY
    ${CMAKE_BINARY_DIR}/modules)
file(MAKE_DIRECTORY ${CMAKE_Fortran_MODULE_DIRECTORY})

add_compile_options(-Wall -Wextra)

add_executable(hello_fortran.exe hello_fortran.f90)</code></pre>
<ul>
<li>Line 1 specifies the minimum version of CMake to use, 3.0 in this
case.</li>
<li>Line 3 specifies the name of the project <code>fortran_basics</code>
and the programming languages for this projects
<code>Fortran</code>.</li>
<li>Line 5 to 7 make sure that the <code>*.mod</code> files that are
generated by the compiler are stored in the build directory.</li>
<li>Line 9 specifies some additional options for the compiler, in this
case <code>-Wall</code> and <code>-Wextra</code> to generate additional
warnings about suspicious code.</li>
<li>Line 11 defines the actual build, it specifies to compile
<code>hello_world.f90</code> into an executable named
<code>hello_fortran.exe</code>.</li>
</ul>
<p>When building software, CMake will create a lot of artifacts that
pollute your source directory, so it is good practice to do the build in
a dedicated subdirectory.</p>
<pre class="bash"><code>$ mkdir build; cd build</code></pre>
<p>Before you can do your first build, CMake has to generate a number of
files and directories based on the <code>CMakeLists.txt</code> file in
your source directory. This is done with the <code>cmake</code>
command.</p>
<pre class="bash"><code>$ cmake ..</code></pre>
<p>The argument of the <code>cmake</code> command is a directory where
the relevant <code>CMakeLists.txt</code> file is located, in this case
<code>..</code> the parent directory of the build directory.</p>
<p>Now you are ready to build the executable.</p>
<pre class="bash"><code>$ make</code></pre>
<p>In case you get compilation or linking errors, correct them. If the
build process succeeded without errors, you can run the executable.</p>
<pre class="bash"><code>$ ./hello_fortran.exe</code></pre>
<h2 id="multiple-source-files">Multiple source files</h2>
<p>Suppose that your application is implemented using multiple source
files, i.e., some modules are stored in their own files. CMake can
handle this very easily, you just have to specify the dependency. For
example, the following specification would use the files
<code>cellular_automata.f90</code> as well as
<code>cellular_automata_mod.f90</code> to build the application
<code>cellular_automata.exe</code>.</p>
<pre><code>add_executable(cellular_automata.exe
    cellular_automata.f90
    cellular_automata_mod.f90)</code></pre>
<h2 id="other-features">Other features</h2>
<p>CMake has many more features exceeding the scope of this
introduction. Some of them are illustrated in the examples.</p>
<p>Functional testing can be done using CTest, and building Doxygen
documentation is also easily integrated into
<code>CMakeLists.txt</code>.</p>
